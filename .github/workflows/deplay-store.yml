name: Upload AAB

on:
  push:
    branches: [ master, feature/aab_upload_actions ]
#    tags:
#      - v*.*
#      - test/*

  workflow_dispatch:
    input:
      loglevel:
        description: 'Log Level'
        required: true
        default: 'warning'
      name:
        description: 'Upload AAB'
        required: true
        default: 'Deploy'

jobs:
  build-release-bundle:
    name: Build AAB
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

#      - name: set up JDK 11
#        uses: actions/setup-java@v1
#        with:
#          java-version: 11

#      - name: Build with Gradle
#        shell: bash
#        run: ./gradlew bundleRelease

      # https://github.com/r0adkll/upload-google-play
      - name: Publish to Google Play Console
        uses: r0adkll/upload-google-play@v1
        with:
          serviceAccountJsonPlainText: ${{ secrets.SERVICE_ACCOUNT_JSON }}
          packageName: dev.eastar.tagout
          releaseFiles: build/app/outputs/bundle/release/*.aab
          track: internal


      # https://github.com/marketplace/actions/firebase-app-distribution
#      - name: Upload to Firebase App Distribution
#        uses: wzieba/Firebase-Distribution-Github-Action@v1.2.2
#        with:
#          appId: ${{ secrets.FIREBASE_APP_ID }}
#          token: ${{ secrets.FIREBASE_TOKEN }}
#          groups: Developers
#          file: app/build/outputs/apk/global/debug/app-global-debug.apk

# TUTORIALS:
# https://github.com/marketplace/actions/upload-android-release-to-play-store
# https://www.youtube.com/watch?v=f3_bkhQRrtU&list=PLEPZdzLLJH951c23xTdB2wpeSikkarDkk&index=12&t=2165s